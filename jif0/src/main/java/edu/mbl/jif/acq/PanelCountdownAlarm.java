/*
 * PanelSequenceMonitor.java
 *
 * Created on August 27, 2006, 9:19 PM
 */
package edu.mbl.jif.acq;

import edu.mbl.jif.camera.Utils;
import edu.mbl.jif.gui.clock.CountdownClock;
import edu.mbl.jif.utils.StaticSwingUtils;
import java.awt.Color;
import java.awt.Font;
import javax.swing.JProgressBar;
import javax.swing.SwingUtilities;

/**
 *
 * @author  GBH
 */
public class PanelCountdownAlarm extends javax.swing.JPanel {

  SequenceController seqCtrl;
  CountdownClock clock;
  private boolean viewWhileAcquiring;

  /** Creates new form PanelSequenceMonitor */
  public PanelCountdownAlarm(SequenceController seqCtrl) {
    this.seqCtrl = seqCtrl;
    initComponents();

    clock = new CountdownClock();
    clock.setBounds(15, 15, 75, 75);
    panelClock.add(clock);

    // jProgressBar2.setMaximum(seqCtrl.getIntervals());

    buttonStart.setEnabled(seqCtrl.initialDelay <= 0);
  }

  public void startSequence() {
    StaticSwingUtils.dispatchToEDT(new Runnable() {

      public void run() {
        buttonStart.setEnabled(false);
        buttonCancel.setEnabled(true);
      }
    });
    seqCtrl.startTimer();
  }

  /** This method is called from within the constructor to
   * initialize the form.
   * WARNING: Do NOT modify this code. The content of this method is
   * always regenerated by the Form Editor.
   */
  // <editor-fold defaultstate="collapsed" desc="Generated Code">//GEN-BEGIN:initComponents
  private void initComponents() {

    panelClock = new javax.swing.JPanel();
    panelButtons = new javax.swing.JPanel();
    buttonStart = new javax.swing.JButton();
    buttonCancel = new javax.swing.JButton();
    panelTitle = new javax.swing.JPanel();
    jLabel4 = new javax.swing.JLabel();
    panelStatus = new javax.swing.JPanel();
    labalBegan = new javax.swing.JLabel();
    labelWillFinish = new javax.swing.JLabel();

    panelClock.setBorder(javax.swing.BorderFactory.createTitledBorder("Next:"));
    panelClock.setMinimumSize(new java.awt.Dimension(90, 90));
    panelClock.setPreferredSize(new java.awt.Dimension(90, 90));

    org.jdesktop.layout.GroupLayout panelClockLayout = new org.jdesktop.layout.GroupLayout(panelClock);
    panelClock.setLayout(panelClockLayout);
    panelClockLayout.setHorizontalGroup(
      panelClockLayout.createParallelGroup(org.jdesktop.layout.GroupLayout.LEADING)
      .add(0, 178, Short.MAX_VALUE)
    );
    panelClockLayout.setVerticalGroup(
      panelClockLayout.createParallelGroup(org.jdesktop.layout.GroupLayout.LEADING)
      .add(0, 142, Short.MAX_VALUE)
    );

    buttonStart.setIcon(new javax.swing.ImageIcon(getClass().getResource("/edu/mbl/jif/acq/icons/action_go.gif"))); // NOI18N
    buttonStart.setText(" Start");
    buttonStart.addActionListener(new java.awt.event.ActionListener() {
      public void actionPerformed(java.awt.event.ActionEvent evt) {
        StartIt(evt);
      }
    });

    buttonCancel.setIcon(new javax.swing.ImageIcon(getClass().getResource("/edu/mbl/jif/acq/icons/cancel.png"))); // NOI18N
    buttonCancel.setText("Cancel");
    buttonCancel.setEnabled(false);
    buttonCancel.addActionListener(new java.awt.event.ActionListener() {
      public void actionPerformed(java.awt.event.ActionEvent evt) {
        CancelIt(evt);
      }
    });

    org.jdesktop.layout.GroupLayout panelButtonsLayout = new org.jdesktop.layout.GroupLayout(panelButtons);
    panelButtons.setLayout(panelButtonsLayout);
    panelButtonsLayout.setHorizontalGroup(
      panelButtonsLayout.createParallelGroup(org.jdesktop.layout.GroupLayout.LEADING)
      .add(panelButtonsLayout.createSequentialGroup()
        .addContainerGap(org.jdesktop.layout.GroupLayout.DEFAULT_SIZE, Short.MAX_VALUE)
        .add(buttonStart)
        .add(18, 18, 18)
        .add(buttonCancel, org.jdesktop.layout.GroupLayout.PREFERRED_SIZE, 87, org.jdesktop.layout.GroupLayout.PREFERRED_SIZE))
    );
    panelButtonsLayout.setVerticalGroup(
      panelButtonsLayout.createParallelGroup(org.jdesktop.layout.GroupLayout.LEADING)
      .add(panelButtonsLayout.createSequentialGroup()
        .add(panelButtonsLayout.createParallelGroup(org.jdesktop.layout.GroupLayout.BASELINE)
          .add(buttonStart)
          .add(buttonCancel))
        .addContainerGap(org.jdesktop.layout.GroupLayout.DEFAULT_SIZE, Short.MAX_VALUE))
    );

    jLabel4.setFont(new java.awt.Font("SansSerif", 1, 12)); // NOI18N
    jLabel4.setText("Countdown Alarm");

    org.jdesktop.layout.GroupLayout panelTitleLayout = new org.jdesktop.layout.GroupLayout(panelTitle);
    panelTitle.setLayout(panelTitleLayout);
    panelTitleLayout.setHorizontalGroup(
      panelTitleLayout.createParallelGroup(org.jdesktop.layout.GroupLayout.LEADING)
      .add(panelTitleLayout.createSequentialGroup()
        .addContainerGap()
        .add(jLabel4, org.jdesktop.layout.GroupLayout.PREFERRED_SIZE, 128, org.jdesktop.layout.GroupLayout.PREFERRED_SIZE)
        .addContainerGap(62, Short.MAX_VALUE))
    );
    panelTitleLayout.setVerticalGroup(
      panelTitleLayout.createParallelGroup(org.jdesktop.layout.GroupLayout.LEADING)
      .add(jLabel4)
    );

    labalBegan.setHorizontalAlignment(javax.swing.SwingConstants.LEFT);
    labalBegan.setText("Began: 00:00:00");

    labelWillFinish.setHorizontalAlignment(javax.swing.SwingConstants.LEFT);
    labelWillFinish.setText("Will finish: 00:00:00");

    org.jdesktop.layout.GroupLayout panelStatusLayout = new org.jdesktop.layout.GroupLayout(panelStatus);
    panelStatus.setLayout(panelStatusLayout);
    panelStatusLayout.setHorizontalGroup(
      panelStatusLayout.createParallelGroup(org.jdesktop.layout.GroupLayout.LEADING)
      .add(panelStatusLayout.createSequentialGroup()
        .addContainerGap()
        .add(panelStatusLayout.createParallelGroup(org.jdesktop.layout.GroupLayout.LEADING)
          .add(labalBegan, org.jdesktop.layout.GroupLayout.PREFERRED_SIZE, 112, org.jdesktop.layout.GroupLayout.PREFERRED_SIZE)
          .add(labelWillFinish, org.jdesktop.layout.GroupLayout.PREFERRED_SIZE, 106, org.jdesktop.layout.GroupLayout.PREFERRED_SIZE))
        .addContainerGap(70, Short.MAX_VALUE))
    );
    panelStatusLayout.setVerticalGroup(
      panelStatusLayout.createParallelGroup(org.jdesktop.layout.GroupLayout.LEADING)
      .add(panelStatusLayout.createSequentialGroup()
        .add(labalBegan)
        .addPreferredGap(org.jdesktop.layout.LayoutStyle.UNRELATED)
        .add(labelWillFinish, org.jdesktop.layout.GroupLayout.DEFAULT_SIZE, 14, Short.MAX_VALUE)
        .add(4, 4, 4))
    );

    org.jdesktop.layout.GroupLayout layout = new org.jdesktop.layout.GroupLayout(this);
    this.setLayout(layout);
    layout.setHorizontalGroup(
      layout.createParallelGroup(org.jdesktop.layout.GroupLayout.LEADING)
      .add(org.jdesktop.layout.GroupLayout.TRAILING, layout.createSequentialGroup()
        .add(layout.createParallelGroup(org.jdesktop.layout.GroupLayout.TRAILING)
          .add(layout.createSequentialGroup()
            .addContainerGap()
            .add(panelButtons, org.jdesktop.layout.GroupLayout.PREFERRED_SIZE, org.jdesktop.layout.GroupLayout.DEFAULT_SIZE, org.jdesktop.layout.GroupLayout.PREFERRED_SIZE))
          .add(layout.createParallelGroup(org.jdesktop.layout.GroupLayout.LEADING)
            .add(org.jdesktop.layout.GroupLayout.TRAILING, layout.createParallelGroup(org.jdesktop.layout.GroupLayout.TRAILING, false)
              .add(org.jdesktop.layout.GroupLayout.LEADING, panelTitle, org.jdesktop.layout.GroupLayout.DEFAULT_SIZE, org.jdesktop.layout.GroupLayout.DEFAULT_SIZE, Short.MAX_VALUE)
              .add(layout.createSequentialGroup()
                .add(10, 10, 10)
                .add(panelClock, org.jdesktop.layout.GroupLayout.DEFAULT_SIZE, 190, Short.MAX_VALUE)))
            .add(layout.createSequentialGroup()
              .add(10, 10, 10)
              .add(panelStatus, org.jdesktop.layout.GroupLayout.DEFAULT_SIZE, org.jdesktop.layout.GroupLayout.DEFAULT_SIZE, Short.MAX_VALUE))))
        .addContainerGap())
    );
    layout.setVerticalGroup(
      layout.createParallelGroup(org.jdesktop.layout.GroupLayout.LEADING)
      .add(org.jdesktop.layout.GroupLayout.TRAILING, layout.createSequentialGroup()
        .addContainerGap(org.jdesktop.layout.GroupLayout.DEFAULT_SIZE, Short.MAX_VALUE)
        .add(panelTitle, org.jdesktop.layout.GroupLayout.PREFERRED_SIZE, org.jdesktop.layout.GroupLayout.DEFAULT_SIZE, org.jdesktop.layout.GroupLayout.PREFERRED_SIZE)
        .addPreferredGap(org.jdesktop.layout.LayoutStyle.UNRELATED)
        .add(panelClock, org.jdesktop.layout.GroupLayout.PREFERRED_SIZE, 168, org.jdesktop.layout.GroupLayout.PREFERRED_SIZE)
        .addPreferredGap(org.jdesktop.layout.LayoutStyle.RELATED)
        .add(panelStatus, org.jdesktop.layout.GroupLayout.PREFERRED_SIZE, 43, org.jdesktop.layout.GroupLayout.PREFERRED_SIZE)
        .addPreferredGap(org.jdesktop.layout.LayoutStyle.UNRELATED)
        .add(panelButtons, org.jdesktop.layout.GroupLayout.PREFERRED_SIZE, org.jdesktop.layout.GroupLayout.DEFAULT_SIZE, org.jdesktop.layout.GroupLayout.PREFERRED_SIZE)
        .add(7, 7, 7))
    );
  }// </editor-fold>//GEN-END:initComponents

    private void CancelIt(java.awt.event.ActionEvent evt) {//GEN-FIRST:event_CancelIt
      clock.cancel();
      seqCtrl.cancel();
      buttonCancel.setEnabled(false);
      String completed = "CANCELLED after " + String.valueOf(seqCtrl.getNDone()) + " invervals";
    }//GEN-LAST:event_CancelIt

    private void StartIt(java.awt.event.ActionEvent evt) {//GEN-FIRST:event_StartIt
      this.startSequence();
    }//GEN-LAST:event_StartIt

  public boolean isViewWhileAcquiring() {
    return viewWhileAcquiring;
  }

  public void allDone() {
    SwingUtilities.invokeLater(new Runnable() {

      public void run() {
        buttonCancel.setEnabled(false);
        if (clock != null) {
          clock.setDone();
        }
      }
    });
  }

  CountdownClock getClock() {
    return clock;
  }

  public void updateStatus() {
    SwingUtilities.invokeLater(new Runnable() {

      public void run() {
        labalBegan.setText("Began: " + Utils.timeFormat(
                seqCtrl.getBeganTime()));
        labelWillFinish.setText("To Finish: " + Utils.timeFormat(
                seqCtrl.getWillEndTime()));
//        labelToGo.setText("To Go: " + Utils.durationHhMmSs(
//                seqCtrl.getToGoTime()));
        String completed = String.valueOf(seqCtrl.getNDone()) + " completed of " +
                String.valueOf(seqCtrl.getIntervals()) + " intervals";
        //labelCompleted.setText(completed);
      }
    });
  }

  // Variables declaration - do not modify//GEN-BEGIN:variables
  private javax.swing.JButton buttonCancel;
  private javax.swing.JButton buttonStart;
  private javax.swing.JLabel jLabel4;
  private javax.swing.JLabel labalBegan;
  private javax.swing.JLabel labelWillFinish;
  private javax.swing.JPanel panelButtons;
  private javax.swing.JPanel panelClock;
  private javax.swing.JPanel panelStatus;
  private javax.swing.JPanel panelTitle;
  // End of variables declaration//GEN-END:variables
}
